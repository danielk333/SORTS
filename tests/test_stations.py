import unittest
import numpy as np
import numpy.testing as nt

import sorts

class TestRadar(unittest.TestCase):
	def setUp(self):
		station = sorts.Station(10, 40, 0, 30, None)

	def test_to_ecef(self):
		enus = np.array([
			[0, 0, 0, 0, 0, 0], 
			[1, 0, 0, 0, 0, 0], 
			[0, 1, 0, 0, 0, 0], 
			[0, 0, 1, 0, 0, 0], 
			[0, 0, 0, 1, 0, 0], 
			[0, 0, 0, 0, 1, 0], 
			[0, 0, 0, 0, 0, 1], 
			], dtype=float).T*1000e3

		ecefs_ref = np.array(
			[[4812193.77349782, 4169406.16381128, 4679171.55193833, 5566600.2802333 , 4812193.77349782, 4812193.77349782, 4812193.77349782],
			 [4037910.02049562, 4803954.4636146 , 3926291.12344667, 4670932.24205511, 4037910.02049562, 4037910.02049562, 4037910.02049562],
			 [1100248.54773536, 1100248.54773536, 2085056.30074757, 1273896.72540229, 1100248.54773536, 1100248.54773536, 1100248.54773536],
			 [      0.        ,       0.        ,       0.        ,       0.		, -642787.60968654, -133022.22155949,  754406.50673549],
			 [      0.        ,       0.        ,       0.        ,       0.		,  766044.44311898, -111618.89704895,  633022.22155949],
			 [      0.        ,       0.        ,       0.        ,       0.		,       0.        ,  984807.75301221,  173648.17766693],
			 ])

		nt.assert_almost_equal(ecefs_ref, station.to_ecef(enus))

	def test_to_enu(self):
		ecefs = np.array(
			[[4812193.77349782, 4169406.16381128, 4679171.55193833, 5566600.2802333 , 4812193.77349782, 4812193.77349782, 4812193.77349782],
			 [4037910.02049562, 4803954.4636146 , 3926291.12344667, 4670932.24205511, 4037910.02049562, 4037910.02049562, 4037910.02049562],
			 [1100248.54773536, 1100248.54773536, 2085056.30074757, 1273896.72540229, 1100248.54773536, 1100248.54773536, 1100248.54773536],
			 [      0.        ,       0.        ,       0.        ,       0.		, -642787.60968654, -133022.22155949,  754406.50673549],
			 [      0.        ,       0.        ,       0.        ,       0.		,  766044.44311898, -111618.89704895,  633022.22155949],
			 [      0.        ,       0.        ,       0.        ,       0.		,       0.        ,  984807.75301221,  173648.17766693],
			 ])

		enus_ref = np.array([
			[0, 0, 0, 0, 0, 0], 
			[1, 0, 0, 0, 0, 0], 
			[0, 1, 0, 0, 0, 0], 
			[0, 0, 1, 0, 0, 0], 
			[0, 0, 0, 1, 0, 0], 
			[0, 0, 0, 0, 1, 0], 
			[0, 0, 0, 0, 0, 1], 
			], dtype=float).T*1000e3

		nt.assert_almost_equal(enus_ref, station.enu(ecefs))